(function e(n,t,r){function o(a,s){if(!t[a]){if(!n[a]){var l=typeof require=="function"&&require;if(!s&&l)return l(a,!0);if(i)return i(a,!0);throw new Error("Cannot find module '"+a+"'")}var u=t[a]={exports:{}};n[a][0].call(u.exports,function(e){var t=n[a][1][e];return o(t?t:e)},u,u.exports,e,n,t,r)}return t[a].exports}var i=typeof require=="function"&&require;for(var a=0;a<r.length;a++)o(r[a]);return o})({1:[function(e,n,t){var r,o,i,a,s,l,u,c,h,d,p,f={}.hasOwnProperty,g=function(e,n){for(var t in n){if(f.call(n,t))e[t]=n[t]}function r(){this.constructor=e}r.prototype=n.prototype;e.prototype=new r;e.__super__=n.prototype;return e};window["receive_asset"]=function(e){};h=function(e){var n,t,o;t=function(e){console.log("error",e);return n(false)};o=function(e){var t,o;console.log("sucess",e);if(e.under){t=r.get();o=PIXI.Sprite.fromImage(e.under,true);t.assetContainer.addChild(o)}if(e.color){t=r.get();o=PIXI.Sprite.fromImage(e.color,true)}if(e.over){t=r.get();o=PIXI.Sprite.fromImage(e.over,true);t.assetContainer.addChild(o)}return n(true)};n=function(n){return function(n){var r;if(e.length>0){r=e.pop();if(n){return p(r,t,o)}}}}(this);return n(true)};p=function(e,n,t){return $.ajax({url:e,dataType:"jsonp",jsonpCallback:"receive_asset",jsonp:"callback",error:n,success:t})};d=function(e){var n;n=new XMLHttpRequest;n.onreadystatechange=function(){if(n.readyState===4&&n.status===200){return parseString(n.responseText,function(e,n){return s(n)})}};n.open("GET",e,false);return n.send()};u=function(e){return d("data/"+e.target.files[0].name)};c=function(){var e,n,t,o,i,a,s;s=new Stats;s.setMode(0);s.domElement.style.position="absolute";s.domElement.style.right="300px";s.domElement.style.top="0px";document.body.appendChild(s.domElement);t=document.createElement("input");t.type="file";t.id="files";t.name="files[]";t.addEventListener("change",u,false);document.body.appendChild(t);o=document.createElement("output");o.id="list";document.body.appendChild(o);i=PIXI.autoDetectRenderer(1024,1024,null,false,true);document.body.appendChild(i.view);e=function(){s.begin();requestAnimFrame(e);i.render(r.get());return s.end()};requestAnimFrame(e);n=new dat.GUI;a=r.get();n.addColor(a,"backgroundColor").onChange(function(e){return a.setBackgroundColor(e.replace("#","0x"))});n.addColor(a,"wallColor").onChange(function(e){return a.wallContainer.tint=e.replace("#","0x")});n.addColor(a,"areaColor").onChange(function(e){return a.areaContainer.tint=e.replace("#","0x")});return d("data/rijksgebouwendienst.xml")};o=function(){function e(e,n){this.x=e;this.y=n;this.edges=[]}e.prototype.addEdge=function(e){return this.edges.push(e)};e.prototype.getAdjacent=function(e){var n,t,r,o,i;o=this.edges;i=[];for(t=0,r=o.length;t<r;t++){n=o[t];if(e!==n){i.push(n)}}return i};return e}();i=function(){function e(e,n,t){this.corner1=e;this.corner2=n;this.thickness=t}e.prototype.getOtherCorner=function(e){if(e.x===this.corner1.x&&e.y===this.corner1.y){return this.corner2}if(e.x===this.corner2.x&&e.y===this.corner2.y){return this.corner1}};return e}();a=function(){function e(){this._cornerMap={}}e.prototype.getCorners=function(){var e,n,t,r;t=this._cornerMap;r=[];for(e in t){n=t[e];r.push(n)}return r};e.prototype.addWall=function(e,n,t){var r,o,a;r=this._addCorner(e.x,e.y);o=this._addCorner(n.x,n.y);a=new i(r,o,t);r.addEdge(a);return o.addEdge(a)};e.prototype._addCorner=function(e,n){if(this._cornerMap[""+e+","+n]){return this._cornerMap[""+e+","+n]}else{this._cornerMap[""+e+","+n]=new o(e,n);return this._cornerMap[""+e+","+n]}};return e}();r=function(e){var n;g(t,e);n=null;t.get=function(){return n!=null?n:n=new t};function t(){t.__super__.constructor.call(this,0);this.backgroundColor="#000000";this.wallColor="#ffffff";this.areaColor="#444444";this.container=new PIXI.Graphics;this.wallContainer=new PIXI.Graphics;this.wallContainer.tint=this.wallColor.replace("#","0x");this.areaContainer=new PIXI.Graphics;this.areaContainer.tint=this.areaColor.replace("#","0x");this.assetContainer=new PIXI.DisplayObjectContainer;this.addChild(this.container);this.addChild(this.areaContainer);this.addChild(this.wallContainer);this.addChild(this.assetContainer);this.wallGraph=new a}t.prototype.destroyData=function(){this.wallGraph=new a;this.container.clear();this.wallContainer.clear();return this.areaContainer.clear()};t.prototype.addLine=function(e){var n,t,r,o,i,a,s,l,u,c;n=100;c=e.points[0].split(" "),o=c[0],a=c[1],l=c[2],i=c[3],s=c[4],u=c[5];t={x:parseInt(o*n),y:parseInt(a*n)};r={x:parseInt(i*n),y:parseInt(s*n)};return this.wallGraph.addWall(t,r,e.thickness[0]*n)};t.prototype.drawLines=function(){var e,n,t,r,o,i,a;this.wallContainer.lineStyle(0,16777215);console.log(this.wallContainer.lineColor);i=this.wallGraph.getCorners();a=[];for(r=0,o=i.length;r<o;r++){e=i[r];a.push(function(){var r,o,i,a;i=e.edges;a=[];for(r=0,o=i.length;r<o;r++){n=i[r];a.push(function(){var r,o,i,a;i=e.edges;a=[];for(r=0,o=i.length;r<o;r++){t=i[r];if(n!==t){this.wallContainer.moveTo(n.getOtherCorner(e).x,n.getOtherCorner(e).y);this._setLineThickness(n.thickness);this.wallContainer.lineTo(e.x,e.y);this._setLineThickness(t.thickness);a.push(this.wallContainer.lineTo(t.getOtherCorner(e).x,t.getOtherCorner(e).y))}else{a.push(void 0)}}return a}.call(this))}return a}.call(this))}return a};t.prototype._setLineThickness=function(e){if(this.lastThickness!==e){this.lastThickness=e;return this.wallContainer.lineStyle(this.lastThickness,16777215)}};t.prototype.drawArea=function(e){var n,t,r,o,i,a;n=e.points[0].split(",");this.areaContainer.beginFill(16777215);this.areaContainer.lineStyle(0,16777215);for(t=i=0,a=n.length;i<a;t=++i){r=n[t];o=r.split(" ");this.areaContainer.lineTo(o[0]*100,o[1]*100);this.areaContainer.lineTo(o[3]*100,o[4]*100)}return this.areaContainer.endFill()};return t}(PIXI.Stage);s=function(e){var n,t,o,i,a,s,u,c,d,p,f,g,C,y,w;c=r.get();c.destroyData();if(e.hasOwnProperty("design")){u=e.design.lines[0].line;t=e.design.areas[0].area;a=e.design.assets[0].asset;console.log(e)}else if(e.hasOwnProperty("project")){u=e.project.floors[0].floor[0].designs[0].design[0].lines[0].line;t=e.project.floors[0].floor[0].designs[0].design[0].areas[0].area}else{console.log("unknown",e)}for(p=0,C=t.length;p<C;p++){n=t[p];c.drawArea(n)}for(f=0,y=u.length;f<y;f++){s=u[f];if(s.type[0]==="default_wall"){c.addLine(s)}else{console.log(""+s.type[0]+" not drawn.")}}i=[];for(g=0,w=a.length;g<w;g++){o=a[g];console.log(o.url2d[0]);if(!l(o.url2d[0],"png")){d="http://cdn.floorplanner.com/assets/"+o.url2d[0].replace("flz/","jsonp/").replace(".flz",".jsonp");i.push(d)}}h(i);c.drawLines();return console.log("lines: "+u.length+", areas: "+t.length)};l=function(e,n){return e.indexOf(n,e.length-n.length)!==-1};window.onload=function(){return c()}},{}]},{},[1]);